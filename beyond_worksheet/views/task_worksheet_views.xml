<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="task_worksheet_action" model="ir.actions.act_window">
        <field name="name">Worksheet</field>
        <field name="res_model">task.worksheet</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="task_worksheet_view_form" model="ir.ui.view">
        <field name="name">task.worksheet.view.form</field>
        <field name="model">task.worksheet</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_create_ccew" class="btn-primary" type="object" string="Create CCEW" invisible="not is_ccew"/>
                    <button name="action_generate_qr_code" class="btn-secondary" type="object" string="Generate QR"
                            invisible="qr_code"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="get_sale_order"
                                icon="fa-dollar" invisible="not sale_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Sale Orders</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" type="object" name="get_task"
                                icon="fa-tasks" invisible="not task_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Tasks</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" type="object" name="get_invoice"
                                icon="fa-pencil-square-o" invisible="not invoice_count">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Invoices</span>
                            </div>
                        </button>
                    </div>
                    <h1>
                        <field name="name" readonly="1"/>
                        <field name="qr_code" widget="image" class="oe_avatar" nolabel="1" invisible="not qr_code"/>
                    </h1>
                    <group>
                        <group>
                            <field name="partner_id"/>
                            <field name="task_id"/>
                            <field name="sale_id"/>
                            <field name="battery_count" invisible="1"/>
                            <field name="x_studio_type_of_service" invisible="1"/>
                            <field name="invoice_count" invisible="1"/>
                            <field name="checklist_count"/>
                            <field name="is_individual"/>
                            <field name="is_ccew"/>
                        </group>

                        <group>
                            <field name="team_member_ids" widget="many2many_tags"/>
                            <field name="is_testing_required"/>
                            <field name="electrical_license_number"/>
                            <field name="is_site_induction"/>
<!--                            <field name="assigned_users" widget="many2many_tags"/>-->
                            <field name="is_ces_activity_created" invisible="1"/>
                            <field name="panel_count" invisible="1"/>
                            <field name="inverter_count" invisible="1"/>
                            <field name="battery_count" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Panel Serial Numbers" name="panels" invisible="panel_count == 0">
                            <field name="panel_lot_ids">
                                <tree string="Panel Serial Numbers">
                                    <field name="image" widget="image" options='{"size": [80, 80]}' class="bg-view"/>
                                    <field name="name"/>
                                    <field name="product_id"/>
                                    <field name="verification_time"/>
                                    <field name="state"/>
                                    <field name="company_id" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Inverter Serial Numbers" invisible="inverter_count == 0">
                            <field name="inverter_lot_ids" invisible="inverter_count == 0">
                                <tree string="Inverter Serial Numbers">
                                    <field name="image" widget="image" options='{"size": [80, 80]}' class="bg-view"/>
                                    <field name="name"/>
                                    <field name="product_id"/>
                                    <field name="verification_time"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Battery Serial Numbers" invisible="battery_count == 0">
                            <field name="battery_lot_ids" invisible="battery_count == 0">
                                <tree string="Battery Serial Numbers">
                                    <field name="image" widget="image" options='{"size": [80, 80]}' class="bg-view"/>
                                    <field name="name"/>
                                    <field name="product_id"/>
                                    <field name="verification_time"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Attendance Record" invisible="not worksheet_attendance_ids">
                            <field name="worksheet_attendance_ids">
                                <tree string="Attendance Record">
                                    <field name="date"/>
                                    <field name="member_id"/>
                                    <field name="type"/>
                                    <field name="additional_service"/>
                                    <field name="in_latitude"/>
                                    <field name="in_longitude"/>
                                    <button
                                            name="action_view_maps"
                                            type="object"
                                            class="btn btn-link ps-0 pt-0 pb-2"
                                            icon="oi-arrow-right"
                                            string="View on Maps"
                                            colspan="2"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Member Questions" invisible="not member_question_ids">
                            <field name="member_question_ids">
                                <tree>
                                    <field name="question_id"/>
                                    <field name="answer"/>
                                    <field name="date"/>
                                    <field name="member_id"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Installation Checklist"
                              invisible="x_studio_type_of_service != 'New Installation'">
                            <widget name="checklist_widget"/>
                        </page>
                        <page string="Service Checklist" invisible="x_studio_type_of_service != 'Service'">
                            <widget name="checklist_widget"/>
                        </page>
                        <page string="CCEW" name="ccew" invisible="not is_ccew">
                            <group>
                                <group>
                                    <field name="ccew_sequence"/>
                                    <field name="ccew_file" widget="pdf_viewer" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="History" name="history">
                            <field name="worksheet_history_ids">
                                <tree string="History">
                                    <field name="changes"/>
                                    <field name="create_date"/>
                                    <field name="user_id"/>
                                    <field name="member_id"/>
                                    <field name="details"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
    <menuitem id="task_worksheet_root" sequence="7" name="Worksheet"/>
    <menuitem id="task_worksheet_menu"
              action="task_worksheet_action" name="Worksheet"
              parent="task_worksheet_root"/>
    <menuitem id="task_worksheet_configuration_menu"
              action="task_worksheet_action" name="Settings"
              parent="task_worksheet_root"/>
</odoo>
